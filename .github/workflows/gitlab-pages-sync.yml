name: Sync Jekyll to GitLab Pages

on:
  push:
    branches: [main]

jobs:
  sync-to-gitlab: # æ›´æ”¹ä»»å‹™åç¨±ï¼Œåæ‡‰æˆ‘å€‘åªåšåŒæ­¥
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout GitHub repo
        uses: actions/checkout@v4 # æ¨è–¦æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

      # ----------------------------------------------------
      # åˆªé™¤ Jekyll å»ºç½®å’Œ Ruby å®‰è£æ­¥é©Ÿ
      # å› ç‚º Jekyll å»ºç½®å°‡åœ¨ GitLab CI/CD ä¸­å®Œæˆ
      # ----------------------------------------------------

      - name: ğŸ”„ Deploy to GitLab
        run: |
          # è¨­ç½® Git èº«ä»½
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # ğŸš¨ é—œéµä¿®æ”¹ï¼šç›´æ¥åœ¨è…³æœ¬ä¸­æ§‹å»º URL
          # æ›¿æ› YOUR_GITLAB_USERNAME ç‚ºä½ çš„ GitLab ä½¿ç”¨è€…åç¨± (ä¾‹å¦‚: xxyzyh)
          # ä½¿ç”¨ https://USERNAME:TOKEN@... æ ¼å¼
          GITLAB_REPO="https://xxyzyh:${{ secrets.GITLAB_TOKEN }}@gitlab.com/xxyzyh/my-blog.git"
          
          # é™¤éŒ¯æ­¥é©Ÿï¼šç¢ºèª URL æ ¼å¼æ­£ç¢º
          echo "Debugging URL (Token hidden):"
          echo $GITLAB_REPO | sed "s/${{ secrets.GITLAB_TOKEN }}/*****/"
          
          # æ·»åŠ é ç¨‹å€‰åº«ä¸¦æ¨é€
          git remote add gitlab $GITLAB_REPO
          echo "ğŸš€ Pushing code to GitLab repository..."
          
          # è¨­ç½® PUSH_URL é¿å…åœ¨æ—¥èªŒä¸­æ„å¤–æ´©éœ² Token
          # é€™è£¡ä½¿ç”¨ $GITLAB_REPO è®Šæ•¸æ¨é€
          git push --force --quiet gitlab main:main
          
          if [ $? -eq 0 ]; then
            echo "âœ… Synchronization complete!"
          else
            echo "âŒ Synchronization FAILED. Check credentials and protected branch settings."
            exit 1
          fi

