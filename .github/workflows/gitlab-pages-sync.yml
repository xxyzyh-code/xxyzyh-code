name: Sync Jekyll to GitLab Pages

on:
  push:
    branches: [main]

jobs:
  sync-to-gitlab: # æ›´æ”¹ä»»å‹™åç¨±ï¼Œåæ‡‰æˆ‘å€‘åªåšåŒæ­¥
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout GitHub repo
        uses: actions/checkout@v4 # æ¨è–¦æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

      # ----------------------------------------------------
      # åˆªé™¤ Jekyll å»ºç½®å’Œ Ruby å®‰è£æ­¥é©Ÿ
      # å› ç‚º Jekyll å»ºç½®å°‡åœ¨ GitLab CI/CD ä¸­å®Œæˆ
      # ----------------------------------------------------

      - name: ğŸ”„ Deploy to GitLab
        env:
          # ç¢ºä¿ GITLAB_TOKEN æ˜¯åœ¨ä½ çš„ GitHub å€‰åº« Settings > Secrets ä¸­é…ç½®çš„ GitLab Personal Access Token
          GITLAB_TOKEN: ${{ secrets.GITLAB_TOKEN }}
          # ä½¿ç”¨ https æ ¼å¼ï¼Œä¸¦åœ¨ URL ä¸­åµŒå…¥ Personal Access Token é€²è¡Œèº«ä»½é©—è­‰
          GITLAB_REPO: https://oauth2:${{ secrets.GITLAB_TOKEN }}@gitlab.com/xxyzyh/my-blog.git 
        run: |
          # 1. é…ç½® Git èº«ä»½
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # 2. æ·»åŠ  GitLab é ç¨‹å€‰åº«
          # 'gitlab' æ˜¯é ç«¯åç¨±ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•åç¨±
          git remote add gitlab $GITLAB_REPO
          
          # 3. å¼·åˆ¶æ¨é€ç•¶å‰åˆ†æ”¯ï¼ˆmainï¼‰åˆ° GitLab å€‰åº«çš„ main åˆ†æ”¯
          # -f (force) å¯ä»¥è¦†è“‹ GitLab ä¸Šå·²æœ‰çš„å…§å®¹ï¼Œç¢ºä¿åŒæ­¥
          # -u (upstream) è¨­å®šè¿½è¹¤ï¼Œè®“å¾ŒçºŒæ“ä½œæ›´æ–¹ä¾¿ (é›–ç„¶é€™è£¡ä¸æœƒæœ‰å¾ŒçºŒæ“ä½œ)
          echo "ğŸš€ Pushing code to GitLab repository..."
          git push --force --quiet gitlab main:main
          echo "âœ… Synchronization complete!"
