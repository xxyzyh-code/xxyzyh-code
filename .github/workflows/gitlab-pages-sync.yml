name: Sync Jekyll to GitLab Pages

on:
  push:
    branches: [main]

jobs:
  sync-to-gitlab:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout GitHub repo
        # æ‹‰å–æ•´å€‹å€‰åº«ï¼Œfetch-depth: 0 å°æ–¼åŒæ­¥å¾ˆé‡è¦
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 

      - name: ğŸ”„ Deploy to GitLab
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          GITLAB_TOKEN_ENCODED=$(echo -n "${{ secrets.GITLAB_TOKEN }}" | xxd -p | sed 's/\(..\)/%\1/g')
          
          GITLAB_REPO="https://xxyzyh:$GITLAB_TOKEN_ENCODED@gitlab.com/xxyzyh/my-blog.git"
          
          echo "Debugging URL (Token Hidden):"
          echo $GITLAB_REPO | sed "s/$GITLAB_TOKEN_ENCODED/*****/"
          
          git remote add gitlab $GITLAB_REPO
          echo "ğŸš€ Pushing code to GitLab repository..."
          
          git push --force --quiet gitlab main:main
          
          if [ $? -eq 0 ]; then
            echo "âœ… Synchronization complete!"
          else
            echo "âŒ Synchronization FAILED. Token or Protected Branch Issue."
            exit 1
          fi
          
